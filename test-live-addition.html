<!-- /home/nneessen/projects/commissionTracker/test-live-addition.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Test Policy Addition - Live</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: background 0.2s;
        }
        button:hover {
            background: #0056b3;
        }
        button.danger {
            background: #dc3545;
        }
        button.danger:hover {
            background: #c82333;
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #218838;
        }
        .output {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success-msg {
            color: #28a745;
            font-weight: bold;
        }
        .error-msg {
            color: #dc3545;
            font-weight: bold;
        }
        .info-msg {
            color: #007bff;
        }
        .policy-card {
            background: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Policy Addition - Live</h1>

        <div>
            <button onclick="checkCurrentPolicies()">üìä Check Current Policies</button>
            <button onclick="addTestPolicy()" class="success">‚ûï Add Test Policy</button>
            <button onclick="clearAllPolicies()" class="danger">üóëÔ∏è Clear All Policies</button>
            <button onclick="window.open('http://localhost:3000', '_blank')">üåê Open App</button>
        </div>

        <div id="output" class="output"></div>
    </div>

    <script>
        const STORAGE_KEY = 'commission_tracker_policies';
        let testCounter = 1;

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success-msg' :
                             type === 'error' ? 'error-msg' : 'info-msg';

            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }

        function checkCurrentPolicies() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                const policies = stored ? JSON.parse(stored) : [];

                log(`Found ${policies.length} policy(ies) in localStorage`, 'info');

                if (policies.length > 0) {
                    log('\nPolicy List:', 'info');
                    policies.forEach((p, i) => {
                        log(`  ${i + 1}. ${p.policyNumber} - ${p.client?.name || 'Unknown'} (${p.status})`, 'info');
                    });
                } else {
                    log('No policies found. Try adding one!', 'info');
                }
            } catch (error) {
                log(`Error reading policies: ${error.message}`, 'error');
            }
        }

        function addTestPolicy() {
            try {
                // Get current policies
                const stored = localStorage.getItem(STORAGE_KEY);
                const policies = stored ? JSON.parse(stored) : [];

                log(`Current count: ${policies.length} policies`, 'info');

                // Create a new test policy with unique data
                const timestamp = Date.now();
                const newPolicy = {
                    id: `test-${timestamp}`,
                    policyNumber: `TEST-${timestamp.toString().slice(-6)}`,
                    status: 'active',
                    client: {
                        name: `Test Client ${testCounter}`,
                        state: 'CA',
                        age: 30 + testCounter,
                        email: `test${testCounter}@example.com`,
                        phone: `555-${String(1000 + testCounter).padStart(4, '0')}`
                    },
                    carrierId: 'carrier-1',
                    product: 'term_life',
                    effectiveDate: new Date().toISOString(),
                    annualPremium: 1200 * testCounter, // Varies by test
                    paymentFrequency: 'monthly',
                    commissionPercentage: 50 + (testCounter * 5), // Varies
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    notes: `Test policy #${testCounter} added at ${new Date().toLocaleString()}`
                };

                // Add to array
                policies.push(newPolicy);

                // Save back to localStorage
                localStorage.setItem(STORAGE_KEY, JSON.stringify(policies));

                log(`‚úÖ Successfully added policy: ${newPolicy.policyNumber}`, 'success');
                log(`   Client: ${newPolicy.client.name}`, 'info');
                log(`   Annual Premium: $${newPolicy.annualPremium}`, 'info');
                log(`   Commission: ${newPolicy.commissionPercentage}%`, 'info');
                log(`New total: ${policies.length} policies`, 'success');
                log('\nüîÑ Refresh the app (http://localhost:3000) to see the new policy!', 'success');

                testCounter++;

                // Verify it was saved
                const verification = localStorage.getItem(STORAGE_KEY);
                const verifyPolicies = JSON.parse(verification);
                if (verifyPolicies.length === policies.length) {
                    log('‚úÖ Verified: Policy saved to localStorage', 'success');
                } else {
                    log('‚ö†Ô∏è Warning: Policy count mismatch after save', 'error');
                }

            } catch (error) {
                log(`‚ùå Error adding policy: ${error.message}`, 'error');
                console.error(error);
            }
        }

        function clearAllPolicies() {
            if (confirm('Are you sure you want to clear all policies? This cannot be undone.')) {
                try {
                    localStorage.removeItem(STORAGE_KEY);
                    log('‚úÖ All policies cleared', 'success');
                    testCounter = 1; // Reset counter
                } catch (error) {
                    log(`‚ùå Error clearing policies: ${error.message}`, 'error');
                }
            }
        }

        // Check on load
        window.onload = () => {
            log('üöÄ Test interface ready!', 'success');
            log('This page directly manipulates localStorage for the Commission Tracker app.\n', 'info');
            checkCurrentPolicies();
        };
    </script>
</body>
</html>