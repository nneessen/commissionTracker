<!-- /home/nneessen/projects/commissionTracker/test-add-policy-comprehensive.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Policy Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        .danger {
            background: #f44336;
        }
        .danger:hover {
            background: #da190b;
        }
        .info {
            background: #2196F3;
        }
        .info:hover {
            background: #0b7dda;
        }
        .output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>üß™ Comprehensive Policy Addition Test</h1>

    <h2>Test Actions</h2>
    <div>
        <button onclick="checkCurrentPolicies()">üìã Check Current Policies</button>
        <button onclick="addTestPolicy()">‚ûï Add Test Policy</button>
        <button onclick="addMultiplePolicies()">‚ûï‚ûï Add 3 Test Policies</button>
        <button onclick="clearAllPolicies()" class="danger">üóëÔ∏è Clear All Policies</button>
        <button onclick="window.location.href='http://localhost:3000'" class="info">üöÄ Open App</button>
    </div>

    <h2>Output</h2>
    <div id="output" class="output">Click a button to see results...</div>

    <script>
        const STORAGE_KEY = 'commission_tracker_policies';

        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += message + '\n';
            console.log(message);
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        function checkCurrentPolicies() {
            clearOutput();
            log('=== Checking Current Policies ===');

            const stored = localStorage.getItem(STORAGE_KEY);
            if (!stored) {
                log('‚ùå No policies found in localStorage');
                log('Key checked: ' + STORAGE_KEY);
                return;
            }

            try {
                const policies = JSON.parse(stored);
                log('‚úÖ Found ' + policies.length + ' policies');
                log('\nPolicies:');
                policies.forEach((p, i) => {
                    log(`\n[${i + 1}] Policy #${p.policyNumber}`);
                    log(`    Client: ${p.client?.name || p.clientName}`);
                    log(`    Status: ${p.status}`);
                    log(`    Annual Premium: $${p.annualPremium}`);
                    log(`    Commission: ${p.commissionPercentage}%`);
                    log(`    ID: ${p.id}`);
                });
            } catch (error) {
                log('‚ùå Error parsing policies: ' + error.message);
            }
        }

        function addTestPolicy() {
            clearOutput();
            log('=== Adding Single Test Policy ===');

            // Get existing policies
            const existing = localStorage.getItem(STORAGE_KEY);
            const policies = existing ? JSON.parse(existing) : [];

            log('Current count: ' + policies.length);

            // Create new policy with all required fields
            const testPolicy = {
                id: 'test-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
                policyNumber: 'POL-' + Date.now(),
                status: 'active',
                client: {
                    name: 'Test Client ' + new Date().toLocaleTimeString(),
                    state: 'CA',
                    age: 35,
                    email: 'test@example.com',
                    phone: '555-0123'
                },
                carrierId: 'carrier-1',
                product: 'term_life',
                effectiveDate: new Date('2024-01-01').toISOString(),
                termLength: 20,
                annualPremium: 1200,
                paymentFrequency: 'monthly',
                commissionPercentage: 50,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                notes: 'Test policy added at ' + new Date().toLocaleString()
            };

            log('\nCreating policy:');
            log('  Policy #: ' + testPolicy.policyNumber);
            log('  Client: ' + testPolicy.client.name);
            log('  Annual Premium: $' + testPolicy.annualPremium);

            // Add to array
            policies.push(testPolicy);

            // Save to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(policies));

            log('\n‚úÖ Policy added successfully!');
            log('New count: ' + policies.length);
            log('\nüîÑ Refresh the app to see the new policy');
        }

        function addMultiplePolicies() {
            clearOutput();
            log('=== Adding Multiple Test Policies ===');

            // Get existing policies
            const existing = localStorage.getItem(STORAGE_KEY);
            const policies = existing ? JSON.parse(existing) : [];

            log('Starting count: ' + policies.length);

            // Add 3 different policies
            const products = ['whole_life', 'term_life', 'universal_life'];
            const states = ['CA', 'NY', 'TX'];
            const names = ['John Smith', 'Jane Doe', 'Bob Johnson'];

            for (let i = 0; i < 3; i++) {
                const timestamp = Date.now() + i;
                const testPolicy = {
                    id: 'multi-' + timestamp + '-' + Math.random().toString(36).substr(2, 9),
                    policyNumber: 'MULTI-' + timestamp,
                    status: i === 0 ? 'active' : i === 1 ? 'pending' : 'active',
                    client: {
                        name: names[i],
                        state: states[i],
                        age: 30 + (i * 5),
                        email: names[i].toLowerCase().replace(' ', '.') + '@example.com',
                        phone: '555-010' + i
                    },
                    carrierId: 'carrier-' + (i + 1),
                    product: products[i],
                    effectiveDate: new Date(2024, i, 1).toISOString(),
                    termLength: i === 1 ? 30 : undefined,
                    annualPremium: 1000 * (i + 1),
                    paymentFrequency: i === 0 ? 'monthly' : i === 1 ? 'quarterly' : 'annual',
                    commissionPercentage: 40 + (i * 10),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    notes: 'Test policy #' + (i + 1) + ' of batch'
                };

                policies.push(testPolicy);
                log(`\n‚úÖ Added policy ${i + 1}: ${testPolicy.policyNumber}`);
            }

            // Save all to localStorage
            localStorage.setItem(STORAGE_KEY, JSON.stringify(policies));

            log('\n‚úÖ All policies added successfully!');
            log('New total count: ' + policies.length);
            log('\nüîÑ Refresh the app to see the new policies');
        }

        function clearAllPolicies() {
            if (!confirm('Are you sure you want to clear ALL policies?')) {
                return;
            }

            clearOutput();
            log('=== Clearing All Policies ===');

            localStorage.removeItem(STORAGE_KEY);

            log('‚úÖ All policies cleared');
            log('\nüîÑ Refresh the app to see empty state');
        }

        // Check on page load
        window.addEventListener('DOMContentLoaded', () => {
            checkCurrentPolicies();
        });
    </script>
</body>
</html>