# RPC Audit (2026-02-14)

Scope: repo-local static analysis across `src/`, `supabase/functions/`, `scripts/`, `tests/`, and `server.js`.

Canonical function inventory source: `src/types/database.types.ts` public Functions block.

## Summary

- Total public functions in type registry: 328
- Functions called via `rpc(...)` and present in registry: 130
- Functions in registry with no repo rpc callsites: 198
- Rpc names called in repo but not in registry: 9

## Active RPC Functions (Used In Repo)

- accept_recruiting_lead
- add_to_read_by
- admin_deleteuser
- admin_get_allusers
- admin_set_admin_role
- admin_update_domain_status
- approve_agency_request
- approve_join_request
- approve_underwriting_rule_set
- can_submit_join_request
- can_workflow_run
- cancel_recruit_invitation
- check_auth_identity
- check_is_imo_admin
- check_team_size_limit
- clone_org_template
- clone_pipeline_template
- complete_instagram_job
- complete_scheduled_delivery
- complete_training_lesson
- create_alert_rule
- create_recruit_invitation
- create_scheduled_report
- delete_alert_rule
- delete_recruit
- duplicate_training_lesson
- enqueue_instagram_job
- fail_instagram_job
- generate_global_knockout_rules
- get_active_system_automations
- get_agencies_for_join
- get_agency_dashboard_metrics
- get_agency_leaderboard_data
- get_agency_metrics
- get_alert_rule_history
- get_alertable_metrics
- get_all_agencies_submit_totals
- get_at_risk_commissions
- get_audit_action_types
- get_audit_log_detail
- get_audit_logs
- get_audit_performers
- get_audit_tables
- get_available_imos_for_join
- get_available_knockout_codes
- get_clients_with_stats
- get_downline_expenses
- get_downline_targets
- get_downline_with_emails
- get_eligible_recipients
- get_imo_dashboard_metrics
- get_imo_expense_summary
- get_imo_metrics
- get_imo_override_summary
- get_imo_performance_report
- get_imo_recruiting_summary
- get_imo_submit_totals
- get_imo_targets
- get_imos_with_system_automations
- get_lead_purchase_stats
- get_lead_stats_by_vendor
- get_leaderboard_data
- get_module_progress_summary
- get_my_alert_rules
- get_my_daily_sales_logs
- get_my_scheduled_reports
- get_org_chart_data
- get_overrides_by_agency
- get_overrides_by_agent
- get_pending_invitations_count
- get_premium_matrices_for_imo
- get_public_landing_page_settings
- get_recruiting_by_agency
- get_recruiting_leads_stats
- get_skill_radar_data
- get_slack_leaderboard_with_periods
- get_submit_leaderboard
- get_team_analytics_data
- get_team_comparison_report
- get_team_leaderboard_data
- get_top_performers_report
- get_training_leaderboard
- get_upline_chain
- get_user_client_ltv
- get_user_cohort_retention
- get_user_commission_aging
- get_user_commission_chargeback_summary
- get_user_expense_summary
- get_user_permissions
- get_user_production_velocity
- get_uw_wizard_usage
- get_vendors_with_stats
- getuser_commission_profile
- graduate_recruit_to_agent
- has_downlines
- has_permission
- has_role
- increment_template_use_count
- increment_usage
- is_admin_user
- is_elevenlabs_available
- log_audit_event
- mark_invitation_sent
- merge_vendors
- record_alert_evaluation
- record_lemon_payment
- record_workflow_email
- reject_agency_request
- reject_join_request
- reject_recruiting_lead
- reject_underwriting_rule_set
- release_alert_rules
- resend_recruit_invitation
- revert_rule_set_to_draft
- search_users_for_assignment
- set_leaderboard_title_batch
- submit_recruiting_lead
- submit_rule_set_for_review
- submit_training_quiz_attempt
- toggle_alert_rule_active
- unenroll_from_pipeline
- update_alert_rule
- update_lead_discovery_call
- update_own_presentation
- update_scheduled_report
- user_has_feature
- user_has_uw_wizard_access
- validate_hierarchy_change
- validate_invitation_acceptance
- validate_invitation_eligibility

## Unused/Deprecated Candidates

### Tier A: Strong Candidates (No repo rpc callsites, no SQL references beyond own definition/grants/comments)

- admin_approve_user
- admin_delete_domain
- admin_deny_user
- admin_get_pending_users
- admin_get_user_by_id
- admin_get_user_profile
- admin_set_pending_user
- admin_update_user
- approve_acceptance_rule
- assign_user_role
- award_training_xp
- calculate_client_age
- calculate_earned_amount
- calculate_months_paid
- calculate_next_run_time
- calculate_premium
- calculate_quiz_score
- calculate_unearned_amount
- can_manage_workflows
- can_request_agency
- can_run_uw_wizard
- can_view_agent_details
- cascade_agency_assignment
- check_and_update_milestones
- check_email_exists
- check_email_quota
- check_first_seller_naming
- check_first_seller_naming_unified
- check_module_completion
- check_training_badges
- check_user_template_limit
- check_workflow_email_rate_limit
- claim_instagram_jobs
- cleanup_expired_evaluation_logs
- cleanup_expired_invitations
- cleanup_instagram_jobs
- cleanup_old_audit_logs
- cleanup_old_reports
- create_alert_notification_safe
- create_lead_from_instagram
- create_notification
- create_org_workflow_template
- create_workflow_run
- email_subject_hash
- ensure_system_labels
- expire_instagram_scheduled_messages
- expire_old_invitations
- generate_age_rules_from_products
- get_active_decision_tree
- get_agency_performance_report
- get_agency_production_by_agent
- get_agency_recruiting_summary
- get_agency_slack_credentials
- get_agency_users_for_sms
- get_agency_weekly_production
- get_agent_contract_summary
- get_agent_daily_stats
- get_all_expense_categories
- get_approaching_deadline_items
- get_carrier_acceptance
- get_commissions_for_threshold_check
- get_current_user_profile_id
- get_downline_expense_summary
- get_due_alert_rules
- get_due_scheduled_reports
- get_imo_contract_stats
- get_imo_expense_by_category
- get_imo_workflow_templates
- get_lead_vendor_heat_metrics
- get_lead_vendor_policy_timeline
- get_license_expirations_for_check
- get_message_stats
- get_my_notification_preferences
- get_password_reminder_users
- get_pending_agency_request_count
- get_pending_first_sale_logs
- get_pending_join_request_count
- get_pipeline_template_for_user
- get_policies_paginated
- get_policy_count
- get_policy_counts_for_check
- get_product_commission_rate
- get_product_rate
- get_public_invitation_by_token
- get_public_recruiter_info
- get_public_recruiting_theme
- get_recruiting_by_recruiter
- get_role_permissions_with_inheritance
- get_schedule_delivery_history
- get_stale_phase_recruits
- get_sync_webhook_secret
- get_team_leaders_for_leaderboard
- get_templates_for_platform
- get_user_addons
- get_user_carrier_performance
- get_user_commission_profile
- get_user_daily_production
- get_user_product_performance
- get_user_profile
- get_workflow_email_usage
- hard_delete_user
- has_subscription_bypass
- health_class_rank
- increment_email_quota
- increment_template_usage
- increment_uw_wizard_usage
- is_caller_admin
- is_contact_favorited
- is_direct_downline_of_owner
- is_same_agency
- is_same_imo
- is_training_module_manager
- is_underwriting_wizard_enabled
- is_user_approved
- lookup_user_by_email
- mark_policy_cancelled
- mark_policy_lapsed
- mark_thread_read
- process_lemon_subscription_event
- process_pending_workflow_runs
- process_workflow_trigger
- rank_to_health_class
- recalculate_lead_purchase_roi
- record_email_click
- record_email_open
- refresh_all_report_materialized_views
- reject_acceptance_rule
- save_workflow_as_org_template
- set_default_decision_tree
- set_leaderboard_title
- show_limit
- show_trgm
- submit_recruit_registration
- table_rating_units
- test_rls_for_user
- units_to_table_rating
- update_daily_leaderboard_title
- update_my_notification_preferences
- update_override_earned_amount
- update_training_streak
- update_user_metadata
- user_has_analytics_section
- validate_template_content_for_platform

### Tier B: Not Called By Repo, But Referenced In SQL (likely internal helper/RLS/policy dependency; do not remove blindly)

- build_agency_org_chart
- build_agent_downline_tree
- build_agent_org_chart
- build_imo_org_chart
- calculate_chargeback_on_policy_lapse
- calculate_commission_advance
- calculate_next_delivery
- check_pending_invitation_exists
- create_default_decision_tree_for_imo
- delete_orphan_identity
- get_agency_descendants
- get_agency_hierarchy
- get_agency_override_summary
- get_current_user_hierarchy_path
- get_daily_production_by_agent
- get_downline_clients_with_stats
- get_downline_ids
- get_imo_admin
- get_imo_production_by_agency
- get_knockout_conditions
- get_lead_stats_by_vendor_imo_aggregate
- get_lead_vendor_admin_overview
- get_lead_vendor_user_breakdown
- get_my_agency_id
- get_my_imo_id
- get_or_create_usage_tracking
- get_plan_by_lemon_variant
- get_policies_for_lapse_check
- get_slack_integrations_for_agency_hierarchy
- get_user_subscription_tier
- get_user_upline_and_recruiter_ids
- get_valid_users_for_rule
- hierarchy_path_array
- invoke_slack_auto_complete_first_sale
- is_admin
- is_agency_owner
- is_agency_owner_of
- is_imo_admin
- is_imo_admin_for
- is_imo_staff_role
- is_staff_role
- is_super_admin
- is_training_hub_staff
- is_upline_of
- normalize_email_subject
- regenerate_override_commissions
- resolve_join_request_approver
- safe_uuid_from_text
- setup_baltimore_life_apriority_rules
- trigger_workflows_for_event
- user_has_instagram_access
- validate_field_requirements
- validate_report_date_range
- validate_schedule_recipients
- validate_social_links_urls

## Called RPC Names Missing From Current Type Registry

These are likely deprecated names, renamed functions, extension functions, or typegen drift.

- admin_approveuser
- admin_denyuser
- admin_get_pendingusers
- admin_getuser_profile
- admin_set_pendinguser
- exec_sql
- get_imo_clients_with_stats
- get_table_row_count
- increment

## Probable Duplicate/Rename Pairs

- admin_approveuser -> admin_approve_user
- admin_denyuser -> admin_deny_user
- admin_get_pendingusers -> admin_get_pending_users
- admin_getuser_profile -> admin_get_user_profile
- admin_set_pendinguser -> admin_set_pending_user
